{"ast":null,"code":"import Konva from \"konva\";\n\nconst uuidv1 = require(\"uuid/v1\");\n\nexport const addTextNode = (stage, layer) => {\n  const id = uuidv1();\n  const textNode = new Konva.Text({\n    text: \"type here\",\n    x: 50,\n    y: 80,\n    fontSize: 20,\n    draggable: true,\n    width: 200,\n    id\n  });\n  layer.add(textNode);\n  let tr = new Konva.Transformer({\n    node: textNode,\n    enabledAnchors: [\"middle-left\", \"middle-right\"],\n    // set minimum width of text\n    boundBoxFunc: function (oldBox, newBox) {\n      newBox.width = Math.max(30, newBox.width);\n      return newBox;\n    }\n  });\n  stage.on(\"click\", function (e) {\n    if (!this.clickStartShape) {\n      return;\n    }\n\n    if (e.target._id == this.clickStartShape._id) {\n      layer.add(tr);\n      tr.attachTo(e.target);\n      layer.draw();\n    } else {\n      tr.detach();\n      layer.draw();\n    }\n  });\n  textNode.on(\"transform\", function () {\n    // reset scale, so only with is changing by transformer\n    textNode.setAttrs({\n      width: textNode.width() * textNode.scaleX(),\n      scaleX: 1\n    });\n  });\n  layer.add(tr);\n  layer.draw();\n  textNode.on(\"dblclick\", () => {\n    // hide text node and transformer:\n    textNode.hide();\n    tr.hide();\n    layer.draw(); // create textarea over canvas with absolute position\n    // first we need to find position for textarea\n    // how to find it?\n    // at first lets find position of text node relative to the stage:\n\n    let textPosition = textNode.absolutePosition(); // then lets find position of stage container on the page:\n\n    let stageBox = stage.container().getBoundingClientRect(); // so position of textarea will be the sum of positions above:\n\n    let areaPosition = {\n      x: stageBox.left + textPosition.x,\n      y: stageBox.top + textPosition.y\n    }; // create textarea and style it\n\n    let textarea = document.createElement(\"textarea\");\n    document.body.appendChild(textarea); // apply many styles to match text on canvas as close as possible\n    // remember that text rendering on canvas and on the textarea can be different\n    // and sometimes it is hard to make it 100% the same. But we will try...\n\n    textarea.value = textNode.text();\n    textarea.style.position = \"absolute\";\n    textarea.style.top = areaPosition.y + \"px\";\n    textarea.style.left = areaPosition.x + \"px\";\n    textarea.style.width = textNode.width() - textNode.padding() * 2 + \"px\";\n    textarea.style.height = textNode.height() - textNode.padding() * 2 + 5 + \"px\";\n    textarea.style.fontSize = textNode.fontSize() + \"px\";\n    textarea.style.border = \"none\";\n    textarea.style.padding = \"0px\";\n    textarea.style.margin = \"0px\";\n    textarea.style.overflow = \"hidden\";\n    textarea.style.background = \"none\";\n    textarea.style.outline = \"none\";\n    textarea.style.resize = \"none\";\n    textarea.style.lineHeight = textNode.lineHeight();\n    textarea.style.fontFamily = textNode.fontFamily();\n    textarea.style.transformOrigin = \"left top\";\n    textarea.style.textAlign = textNode.align();\n    textarea.style.color = textNode.fill();\n    let rotation = textNode.rotation();\n    let transform = \"\";\n\n    if (rotation) {\n      transform += \"rotateZ(\" + rotation + \"deg)\";\n    }\n\n    let px = 0;\n    let isFirefox = navigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1;\n\n    if (isFirefox) {\n      px += 2 + Math.round(textNode.fontSize() / 20);\n    }\n\n    transform += \"translateY(-\" + px + \"px)\";\n    textarea.style.transform = transform;\n    textarea.style.height = \"auto\"; // after browsers resized it we can set actual value\n\n    textarea.style.height = textarea.scrollHeight + 3 + \"px\";\n    textarea.focus();\n\n    function removeTextarea() {\n      textarea.parentNode.removeChild(textarea);\n      window.removeEventListener(\"click\", handleOutsideClick);\n      textNode.show();\n      tr.show();\n      tr.forceUpdate();\n      layer.draw();\n    }\n\n    function setTextareaWidth(newWidth) {\n      if (!newWidth) {\n        // set width for placeholder\n        newWidth = textNode.placeholder.length * textNode.fontSize();\n      } // some extra fixes on different browsers\n\n\n      let isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n      let isFirefox = navigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1;\n\n      if (isSafari || isFirefox) {\n        newWidth = Math.ceil(newWidth);\n      }\n\n      let isEdge = document.documentMode || /Edge/.test(navigator.userAgent);\n\n      if (isEdge) {\n        newWidth += 1;\n      }\n\n      textarea.style.width = newWidth + \"px\";\n    }\n\n    textarea.addEventListener(\"keydown\", function (e) {\n      // hide on enter\n      // but don't hide on shift + enter\n      if (e.keyCode === 13 && !e.shiftKey) {\n        textNode.text(textarea.value);\n        removeTextarea();\n      } // on esc do not set value back to node\n\n\n      if (e.keyCode === 27) {\n        removeTextarea();\n      }\n    });\n    textarea.addEventListener(\"keydown\", function (e) {\n      let scale = textNode.getAbsoluteScale().x;\n      setTextareaWidth(textNode.width() * scale);\n      textarea.style.height = \"auto\";\n      textarea.style.height = textarea.scrollHeight + textNode.fontSize() + \"px\";\n    });\n\n    function handleOutsideClick(e) {\n      if (e.target !== textarea) {\n        removeTextarea();\n      }\n    }\n\n    setTimeout(() => {\n      window.addEventListener(\"click\", handleOutsideClick);\n    });\n  });\n  return id;\n};","map":{"version":3,"sources":["/home/mdehaan51/highrev-projects/merch-designer/client/src/components/DrawingComponents/TextNode.js"],"names":["Konva","uuidv1","require","addTextNode","stage","layer","id","textNode","Text","text","x","y","fontSize","draggable","width","add","tr","Transformer","node","enabledAnchors","boundBoxFunc","oldBox","newBox","Math","max","on","e","clickStartShape","target","_id","attachTo","draw","detach","setAttrs","scaleX","hide","textPosition","absolutePosition","stageBox","container","getBoundingClientRect","areaPosition","left","top","textarea","document","createElement","body","appendChild","value","style","position","padding","height","border","margin","overflow","background","outline","resize","lineHeight","fontFamily","transformOrigin","textAlign","align","color","fill","rotation","transform","px","isFirefox","navigator","userAgent","toLowerCase","indexOf","round","scrollHeight","focus","removeTextarea","parentNode","removeChild","window","removeEventListener","handleOutsideClick","show","forceUpdate","setTextareaWidth","newWidth","placeholder","length","isSafari","test","ceil","isEdge","documentMode","addEventListener","keyCode","shiftKey","scale","getAbsoluteScale","setTimeout"],"mappings":"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","sourcesContent":["import Konva from \"konva\";\nconst uuidv1 = require(\"uuid/v1\");\nexport const addTextNode = (stage, layer) => {\n\tconst id = uuidv1();\n\tconst textNode = new Konva.Text({\n\t\ttext: \"type here\",\n\t\tx: 50,\n\t\ty: 80,\n\t\tfontSize: 20,\n\t\tdraggable: true,\n\t\twidth: 200,\n\t\tid\n\t});\n\tlayer.add(textNode);\n\tlet tr = new Konva.Transformer({\n\t\tnode: textNode,\n\t\tenabledAnchors: [\"middle-left\", \"middle-right\"],\n\t\t// set minimum width of text\n\t\tboundBoxFunc: function(oldBox, newBox) {\n\t\t\tnewBox.width = Math.max(30, newBox.width);\n\t\t\treturn newBox;\n\t\t}\n\t});\n\tstage.on(\"click\", function(e) {\n\t\tif (!this.clickStartShape) {\n\t\t\treturn;\n\t\t}\n\t\tif (e.target._id == this.clickStartShape._id) {\n\t\t\tlayer.add(tr);\n\t\t\ttr.attachTo(e.target);\n\t\t\tlayer.draw();\n\t\t} else {\n\t\t\ttr.detach();\n\t\t\tlayer.draw();\n\t\t}\n\t});\n\ttextNode.on(\"transform\", function() {\n\t\t// reset scale, so only with is changing by transformer\n\t\ttextNode.setAttrs({\n\t\t\twidth: textNode.width() * textNode.scaleX(),\n\t\t\tscaleX: 1\n\t\t});\n\t});\n\tlayer.add(tr);\n\tlayer.draw();\n\ttextNode.on(\"dblclick\", () => {\n\t\t// hide text node and transformer:\n\t\ttextNode.hide();\n\t\ttr.hide();\n\t\tlayer.draw();\n\t\t// create textarea over canvas with absolute position\n\t\t// first we need to find position for textarea\n\t\t// how to find it?\n\t\t// at first lets find position of text node relative to the stage:\n\t\tlet textPosition = textNode.absolutePosition();\n\t\t// then lets find position of stage container on the page:\n\t\tlet stageBox = stage.container().getBoundingClientRect();\n\t\t// so position of textarea will be the sum of positions above:\n\t\tlet areaPosition = {\n\t\t\tx: stageBox.left + textPosition.x,\n\t\t\ty: stageBox.top + textPosition.y\n\t\t};\n\t\t// create textarea and style it\n\t\tlet textarea = document.createElement(\"textarea\");\n\t\tdocument.body.appendChild(textarea);\n\t\t// apply many styles to match text on canvas as close as possible\n\t\t// remember that text rendering on canvas and on the textarea can be different\n\t\t// and sometimes it is hard to make it 100% the same. But we will try...\n\t\ttextarea.value = textNode.text();\n\t\ttextarea.style.position = \"absolute\";\n\t\ttextarea.style.top = areaPosition.y + \"px\";\n\t\ttextarea.style.left = areaPosition.x + \"px\";\n\t\ttextarea.style.width = textNode.width() - textNode.padding() * 2 + \"px\";\n\t\ttextarea.style.height =\n\t\t\ttextNode.height() - textNode.padding() * 2 + 5 + \"px\";\n\t\ttextarea.style.fontSize = textNode.fontSize() + \"px\";\n\t\ttextarea.style.border = \"none\";\n\t\ttextarea.style.padding = \"0px\";\n\t\ttextarea.style.margin = \"0px\";\n\t\ttextarea.style.overflow = \"hidden\";\n\t\ttextarea.style.background = \"none\";\n\t\ttextarea.style.outline = \"none\";\n\t\ttextarea.style.resize = \"none\";\n\t\ttextarea.style.lineHeight = textNode.lineHeight();\n\t\ttextarea.style.fontFamily = textNode.fontFamily();\n\t\ttextarea.style.transformOrigin = \"left top\";\n\t\ttextarea.style.textAlign = textNode.align();\n\t\ttextarea.style.color = textNode.fill();\n\t\tlet rotation = textNode.rotation();\n\t\tlet transform = \"\";\n\t\tif (rotation) {\n\t\t\ttransform += \"rotateZ(\" + rotation + \"deg)\";\n\t\t}\n\t\tlet px = 0;\n\t\tlet isFirefox =\n\t\t\tnavigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1;\n\t\tif (isFirefox) {\n\t\t\tpx += 2 + Math.round(textNode.fontSize() / 20);\n\t\t}\n\t\ttransform += \"translateY(-\" + px + \"px)\";\n\t\ttextarea.style.transform = transform;\n\t\ttextarea.style.height = \"auto\";\n\t\t// after browsers resized it we can set actual value\n\t\ttextarea.style.height = textarea.scrollHeight + 3 + \"px\";\n\t\ttextarea.focus();\n\t\tfunction removeTextarea() {\n\t\t\ttextarea.parentNode.removeChild(textarea);\n\t\t\twindow.removeEventListener(\"click\", handleOutsideClick);\n\t\t\ttextNode.show();\n\t\t\ttr.show();\n\t\t\ttr.forceUpdate();\n\t\t\tlayer.draw();\n\t\t}\n\t\tfunction setTextareaWidth(newWidth) {\n\t\t\tif (!newWidth) {\n\t\t\t\t// set width for placeholder\n\t\t\t\tnewWidth = textNode.placeholder.length * textNode.fontSize();\n\t\t\t}\n\t\t\t// some extra fixes on different browsers\n\t\t\tlet isSafari = /^((?!chrome|android).)*safari/i.test(\n\t\t\t\tnavigator.userAgent\n\t\t\t);\n\t\t\tlet isFirefox =\n\t\t\t\tnavigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1;\n\t\t\tif (isSafari || isFirefox) {\n\t\t\t\tnewWidth = Math.ceil(newWidth);\n\t\t\t}\n\t\t\tlet isEdge =\n\t\t\t\tdocument.documentMode || /Edge/.test(navigator.userAgent);\n\t\t\tif (isEdge) {\n\t\t\t\tnewWidth += 1;\n\t\t\t}\n\t\t\ttextarea.style.width = newWidth + \"px\";\n\t\t}\n\t\ttextarea.addEventListener(\"keydown\", function(e) {\n\t\t\t// hide on enter\n\t\t\t// but don't hide on shift + enter\n\t\t\tif (e.keyCode === 13 && !e.shiftKey) {\n\t\t\t\ttextNode.text(textarea.value);\n\t\t\t\tremoveTextarea();\n\t\t\t}\n\t\t\t// on esc do not set value back to node\n\t\t\tif (e.keyCode === 27) {\n\t\t\t\tremoveTextarea();\n\t\t\t}\n\t\t});\n\t\ttextarea.addEventListener(\"keydown\", function(e) {\n\t\t\tlet scale = textNode.getAbsoluteScale().x;\n\t\t\tsetTextareaWidth(textNode.width() * scale);\n\t\t\ttextarea.style.height = \"auto\";\n\t\t\ttextarea.style.height =\n\t\t\t\ttextarea.scrollHeight + textNode.fontSize() + \"px\";\n\t\t});\n\t\tfunction handleOutsideClick(e) {\n\t\t\tif (e.target !== textarea) {\n\t\t\t\tremoveTextarea();\n\t\t\t}\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\twindow.addEventListener(\"click\", handleOutsideClick);\n\t\t});\n\t});\n\treturn id;\n};\n"]},"metadata":{},"sourceType":"module"}