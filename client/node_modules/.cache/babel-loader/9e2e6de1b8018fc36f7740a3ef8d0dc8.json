{"ast":null,"code":"import _objectSpread from \"/home/mdehaan/dev/sock-design/Shock-Merch-Designer/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _slicedToArray from \"/home/mdehaan/dev/sock-design/Shock-Merch-Designer/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/mdehaan/dev/sock-design/Shock-Merch-Designer/client/src/components/DrawingComponents/ShapeElement.js\";\nimport React, { useEffect } from \"react\";\nimport { Image, Transformer } from \"react-konva\";\nimport Konva from \"konva\";\nimport useImage from \"use-image\";\n\nconst ShapeElement = ({\n  shapeProps,\n  isSelected,\n  onSelect,\n  onChange,\n  url,\n  hex,\n  blue,\n  red,\n  green,\n  x,\n  y\n}) => {\n  const shapeRef = React.useRef();\n  const trRef = React.useRef();\n\n  const _useImage = useImage(url),\n        _useImage2 = _slicedToArray(_useImage, 1),\n        image = _useImage2[0];\n\n  useEffect(() => {\n    if (hex) {\n      shapeRef.current.cache(); // since this update is not handled by \"react-konva\" and we are using Konva methods directly\n      // we have to redraw layer manually\n\n      shapeRef.current.getLayer().batchDraw();\n    }\n  });\n  useEffect(() => {\n    if (isSelected) {\n      // we need to attach transformer manually\n      trRef.current.setNode(shapeRef.current);\n      trRef.current.getLayer().batchDraw();\n    }\n  }, [isSelected]);\n  return React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45\n    },\n    __self: this\n  }, React.createElement(Image, Object.assign({\n    onClick: onSelect,\n    onTap: onSelect,\n    ref: shapeRef\n  }, shapeProps, {\n    x: x,\n    y: y,\n    draggable: true,\n    image: image,\n    onDragEnd: e => {\n      onChange(_objectSpread({}, shapeProps, {\n        x: e.target.x(),\n        y: e.target.y()\n      }));\n    },\n    onTransformEnd: e => {\n      // transformer is changing scale\n      const node = shapeRef.current;\n      const scaleX = node.scaleX();\n      const scaleY = node.scaleY(); // we will reset it back\n\n      node.scaleX(1);\n      node.scaleY(1);\n      onChange(_objectSpread({}, shapeProps, {\n        x: node.x(),\n        y: node.y(),\n        width: node.width() * scaleX,\n        height: node.height() * scaleY\n      }));\n    },\n    opacity: 0.8,\n    filters: [Konva.Filters.RGB],\n    blue: blue,\n    red: red,\n    green: green,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 46\n    },\n    __self: this\n  })), isSelected && React.createElement(Transformer, {\n    ref: trRef,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85\n    },\n    __self: this\n  }));\n};\n\nexport default ShapeElement;","map":{"version":3,"sources":["/home/mdehaan/dev/sock-design/Shock-Merch-Designer/client/src/components/DrawingComponents/ShapeElement.js"],"names":["React","useEffect","Image","Transformer","Konva","useImage","ShapeElement","shapeProps","isSelected","onSelect","onChange","url","hex","blue","red","green","x","y","shapeRef","useRef","trRef","image","current","cache","getLayer","batchDraw","setNode","e","target","node","scaleX","scaleY","width","height","Filters","RGB"],"mappings":"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","sourcesContent":["// @flow\nimport React, {  useEffect } from \"react\";\nimport { Image, Transformer } from \"react-konva\";\nimport Konva from \"konva\";\nimport useImage from \"use-image\";\n\nconst ShapeElement = ({\n\tshapeProps,\n\tisSelected,\n\tonSelect,\n\tonChange,\n\turl,\n\thex,\n\tblue,\n\tred,\n\tgreen,\n\tx,\n\ty\n}) => {\n\tconst shapeRef = React.useRef();\n\tconst trRef = React.useRef();\n\tconst [image] = useImage(url);\n\n\n\tuseEffect(() => {\n\t\tif (hex) {\n\t\t\tshapeRef.current.cache();\n\t\t\t// since this update is not handled by \"react-konva\" and we are using Konva methods directly\n\t\t\t// we have to redraw layer manually\n\t\t\tshapeRef.current.getLayer().batchDraw();\n\t\t}\n\t});\n\n\tuseEffect(() => {\n\t\tif (isSelected) {\n\t\t\t// we need to attach transformer manually\n\n\t\t\ttrRef.current.setNode(shapeRef.current);\n\n\t\t\ttrRef.current.getLayer().batchDraw();\n\t\t}\n\t}, [isSelected]);\n\n\treturn (\n\t\t<React.Fragment>\n\t\t\t<Image\n\t\t\t\tonClick={onSelect}\n\t\t\t\tonTap={onSelect}\n\t\t\t\tref={shapeRef}\n\t\t\t\t{...shapeProps}\n\t\t\t\tx={x}\n\t\t\t\ty={y}\n\t\t\t\tdraggable\n\t\t\t\timage={image}\n\t\t\t\tonDragEnd={e => {\n\t\t\t\t\tonChange({\n\t\t\t\t\t\t...shapeProps,\n\t\t\t\t\t\tx: e.target.x(),\n\t\t\t\t\t\ty: e.target.y()\n\t\t\t\t\t});\n\t\t\t\t}}\n\t\t\t\tonTransformEnd={e => {\n\t\t\t\t\t// transformer is changing scale\n\t\t\t\t\tconst node = shapeRef.current;\n\t\t\t\t\tconst scaleX = node.scaleX();\n\t\t\t\t\tconst scaleY = node.scaleY();\n\n\t\t\t\t\t// we will reset it back\n\t\t\t\t\tnode.scaleX(1);\n\t\t\t\t\tnode.scaleY(1);\n\t\t\t\t\tonChange({\n\t\t\t\t\t\t...shapeProps,\n\t\t\t\t\t\tx: node.x(),\n\t\t\t\t\t\ty: node.y(),\n\t\t\t\t\t\twidth: node.width() * scaleX,\n\t\t\t\t\t\theight: node.height() * scaleY\n\t\t\t\t\t});\n\t\t\t\t}}\n\t\t\t\topacity={0.8}\n\t\t\t\tfilters={[Konva.Filters.RGB]}\n\t\t\t\tblue={blue}\n\t\t\t\tred={red}\n\t\t\t\tgreen={green}\n\t\t\t/>\n\t\t\t{isSelected && <Transformer ref={trRef} />}\n\t\t</React.Fragment>\n\t);\n};\n\nexport default ShapeElement;\n"]},"metadata":{},"sourceType":"module"}